<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>لیست رکوردها</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
</head>
<body class="p-4">

<div class="container">
    <h2 class="text-center mb-4">لیست رکوردها</h2>

    <div id="alert-placeholder"></div>

    <table class="table table-bordered table-striped text-center">
        <thead class="table-dark">
            <tr>
                <th>شناسه</th>
                <th>توضیح</th>
                <th>تاریخ</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
            {% for record in records %}
            <tr id="record-{{ record.id }}">
                <td>{{ record.id }}</td>
                <td>{{ record.description }}</td>
                <td>{{ record.date }}</td>
                <td>
                    <button class="btn btn-danger btn-sm delete-btn" data-id="{{ record.id }}">
                        حذف
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">هیچ رکوردی وجود ندارد.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
$(document).ready(function() {
    $('.delete-btn').click(function() {
        let recordId = $(this).data('id');
        if (confirm('آیا مطمئن هستید که می‌خواهید این رکورد حذف شود؟')) {
            $.ajax({
                url: "{% url 'delete_record_ajax' 0 %}".replace('0', recordId),
                type: 'POST',
                headers: {'X-Requested-With': 'XMLHttpRequest'},
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.success) {
                        $('#record-' + recordId).remove(); // حذف سطر از جدول
                        $('#alert-placeholder').html('<div class="alert alert-success">'+response.message+'</div>');
                    } else {
                        $('#alert-placeholder').html('<div class="alert alert-danger">'+response.message+'</div>');
                    }
                },
                error: function() {
                    $('#alert-placeholder').html('<div class="alert alert-danger">خطا در حذف رکورد!</div>');
                }
            });
        }
    });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
